<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Basic Page Needs
      â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
   <meta charset="utf-8">
   <title>Ultimate Flaggle</title>
   <meta name="description" content="Website for playing the game 'Ultimate Flaggle'.">
   <meta name="author" content="Cheylea Hopkinson">
   <!-- CSS
      â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
   <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/stylesheet.css') }}" media="screen and (min-width: 768px)">
   <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/stylesheet-mobile.css') }}" media="screen and (max-width: 767px)">
   
   <!-- Favicon
      â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
   <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Libraries
      â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<!-- Header -->
<div class="header">
   <h2>Ultimate Flaggle</h2>
</div>

<!-- Popup icons for how to play and view current stats -->
<div class="row">
  <div class="column-left" ></div>
  <div class="column-mid">
    <!-- How to button -->
    <header style="background-color:#E9F1F7;">
      <span style="border-radius: 50%; margin: 2px;" onclick="document.getElementById('howToPopup').style.display='block'" class="how-to topright">&#10067;</span>
    </header>
    <!-- Stats button -->
    <header style="background-color:#E9F1F7;">
      <span style="border-radius: 50%; margin: 2px;" onclick="document.getElementById('myStats').style.display='block'" class="how-to topright">&#128202;</span>
    </header>
    <br>
    <br>
    
    <!--Generate countries -->
    <form action="{{ url_for('guesscountry') }}" method="post">
      <select id="guessedcountry" name="guessedcountry" class="select">
          <option disabled selected value> -- pick a country to guess! -- </option>
          {% for country in countries %}
          <option value="{{ country }}">{{ country }}</option>
          {% endfor %}
      </select>
    
      <!-- Guess button -->
      <input class="guessButton" id="guess-button" type="submit" value="GUESS!">
    </form>

    <!-- Display possible colours-->
    <br>
    <p><div class="circle-main" style="background: #000000;"></div>
      <div class="circle-main" style="background: #FFFFFF;"></div>
      <div class="circle-main" style="background: #CE2424;"></div>
      <div class="circle-main" style="background: #D0103A;"></div>
      <div class="circle-main" style="background: #007934;"></div>
      <div class="circle-main" style="background: #9216A0;"></div>
      <div class="circle-main" style="background: #0F41A3;"></div>
      <div class="circle-main" style="background: #00AFCA;"></div>
      <div class="circle-main" style="background: #8CB9DA;"></div>
      <div class="circle-main" style="background: #DECDB6;"></div>
      <div class="circle-main" style="background: #FAF341;"></div>
      <div class="circle-main" style="background: #EACB3F;"></div>
      <div class="circle-main" style="background: #ff8000;"></div>
      <div class="circle-main" style="background: #61362E;"></div>
      <div class="circle-main" style="background: #a0a0a0;"></div>
      <div class="circle-main" style="background: #F48E93;"></div>
    </p>
    <br>
    <br>
    <table class="myTable" style="border-radius:  15px 15px 15px 15px;">
      <tr>
          <th>Flag</th>
          <th>Country</th>
          <th>Distance</th>
          <th>Direction</th>
          <th>Difference</th>
      </tr>
      {% for flag, country, distance, direction, image in guesses %}
      <tr>
         <td><img src="{{ flag }}" onmouseover="changeImageOnHover(this)" onmouseout="revertImage(this)" style="cursor:pointer;max-width: 100%; height: auto;"></td>
          <td>{{ country }}</td>
          <td>{{ distance }}</td>
          <td><img src="{{ direction }}" style="max-width: 50%; height: auto;"></td>
          <td><img src="{{ image }}" style="max-width: 100%; height: auto;"></td>
      </tr>
      {% endfor %}
    </table>
    <br>
   <!--Hidden pop ups-->
    <!-- Current Stats -->
    <div class="howToPopup" id="myStats" style="display: none;">
      <!-- Close button in the top right -->
      <header style="background-color:#E9F1F7;color:#231651;">
        <span onclick="document.getElementById('myStats').style.display='none'" class="close-button topright">&times;</span>
      </header>
      <!-- Stats -->
      <table class="statsTable">
        <tr>
            <th>Win Streak</th>
            <th>Average Guesses</th>
            <th>Average Minutes</th>
        </tr>
        <tr>
           <td>{{current_streak}}</td>
            <td>{{ average_win_guesses }}</td>
            <td>{{ average_win_time }}</td>
        </tr>
      </table>
      <table class="statsTable">
        <tr>
            <th>Max Streak</th>
            <th>Win Rate</th>
            <th>Total Played</th>
        </tr>
        <tr>
            <td>{{ max_streak }}</td>
            <td>{{ win_rate }}</td>
            <td>{{ total_played }}</td>
        </tr>
      </table>
      <canvas id="userChart"></canvas>
    </div>
    <!-- How to pop up -->
    <div class="howToPopup" id="howToPopup">
      <!-- Close button in the top right -->
      <header style="background-color:#E9F1F7;color:#231651;">
        <span onclick="document.getElementById('howToPopup').style.display='none'" class="close-button topright">&times;</span>
      </header>
      <!-- Show icon on the page -->
      <img src="{{ url_for('static', filename='images/favicon.png') }}" alt="ultimate flaggle logo">
      <!-- How to details -->
      <h1>How does it work?</h1>
      <br>
      <p>
        This version of flaggle works by combining the approachs of <a href="https://flagle.gg/" target="_blank">FLAGLE</a> and <a href="https://www.flaggle.net/" target="_blank">Flaggle</a>.
        You guess a country and are shown hints for how close you are to the country to guess. Hints are the distance, direction and flag colour comparison.
        The flag colour comparison works by comparing the pixel colours in the same position and will highlight green when they match.
        Please note, flags have been "cleaned" to be the same dimensions and a set of 16 colour shades so may not look exactly identical to the original flag.
      </p>
      <br>
      <p> Colours used to process flags:</p>
      <br>
      <p><div class="circle" style="background: #000000;"></div>
        <div class="circle" style="background: #FFFFFF;"></div>
        <div class="circle" style="background: #CE2424;"></div>
        <div class="circle" style="background: #D0103A;"></div>
        <div class="circle" style="background: #007934;"></div>
        <div class="circle" style="background: #9216A0;"></div>
        <div class="circle" style="background: #0F41A3;"></div>
        <div class="circle" style="background: #00AFCA;"></div>
        <div class="circle" style="background: #8CB9DA;"></div>
        <div class="circle" style="background: #DECDB6;"></div>
        <div class="circle" style="background: #FAF341;"></div>
        <div class="circle" style="background: #EACB3F;"></div>
        <div class="circle" style="background: #ff8000;"></div>
        <div class="circle" style="background: #61362E;"></div>
        <div class="circle" style="background: #a0a0a0;"></div>
        <div class="circle" style="background: #F48E93;"></div>
      </p>
    </div>

    <!-- Winning pop up-->
    <div class="howToPopup" id="youWin" style="display: none;">
      <!-- Close button in the top right -->
      <header style="background-color:#E9F1F7;color:#231651;">
        <span onclick="document.getElementById('youWin').style.display='none'" class="close-button topright">&times;</span>
      </header>
      <!-- Winning details and stats -->
      <p>You won!</p>
      <table class="statsTable">
        <tr>
            <th>Win Streak</th>
            <th>Average Guesses</th>
            <th>Average Minutes</th>
        </tr>
        <tr>
           <td>{{current_streak}}</td>
            <td>{{ average_win_guesses }}</td>
            <td>{{ average_win_time }}</td>
        </tr>
      </table>
      <table class="statsTable">
        <tr>
            <th>Max Streak</th>
            <th>Win Rate</th>
            <th>Total Played</th>
        </tr>
        <tr>
            <td>{{ max_streak }}</td>
            <td>{{ win_rate }}</td>
            <td>{{ total_played }}</td>
        </tr>
      </table>
      <canvas id="userChartWin"></canvas>
    </div>
  
    <!-- Losing pop up -->
    <div class="howToPopup" id="youLose" style="display: none;">
      <!-- Close button in the top right -->
      <header style="background-color:#E9F1F7;color:#231651;">
        <span onclick="document.getElementById('youLose').style.display='none'" class="close-button topright">&times;</span>
      </header>
      <!-- Losing details and stats -->
      <p>You lose!</p>
      <table class="statsTable">
        <tr>
            <th>Win Streak</th>
            <th>Average Guesses</th>
            <th>Average Minutes</th>
        </tr>
        <tr>
           <td>{{current_streak}}</td>
            <td>{{ average_win_guesses }}</td>
            <td>{{ average_win_time }}</td>
        </tr>
      </table>
      <table class="statsTable">
        <tr>
            <th>Max Streak</th>
            <th>Win Rate</th>
            <th>Total Played</th>
        </tr>
        <tr>
            <td>{{ max_streak }}</td>
            <td>{{ win_rate }}</td>
            <td>{{ total_played }}</td>
        </tr>
      </table>
      <canvas id="userChartLose"></canvas>
    </div>
  </div>
  <div class="column-left" ></div>
</div>

<!-- Footer -->
<div class="footer">
  <p>All rights reserved Â© ðŸŒ¸ <a href="https://cheylea.github.io/" target="_blank">Cheylea Hopkinson</a> 2025. Contact on ðŸ”— <a href="https://www.linkedin.com/in/cheyleahopkinson/" target="_blank">LinkedIn</a>. â˜• <a href="https://www.ko-fi.com/cheylea" target="_blank">Buy me a coffee?</a></a></p>
</div>

<script>
  function closeWinPopup() {
    document.getElementById("youWin").style.display = "none";
  }
  function closeLosePopup() {
    document.getElementById("youLose").style.display = "none";
  }
  window.onload = function() {
    var won = {{ won | tojson }};
    var lost = {{ lost | tojson }};

    if (won === 1) {
        document.getElementById("youWin").style.display = "block";
        document.getElementById("guess-button").style.display = "none";

        setTimeout(() => {
          const ctxWin = document.getElementById('userChartWin').getContext('2d');
          new Chart(ctxWin, {
              type: 'bar',
              data: {
                  labels: labels,
                  datasets: [{
                      label: 'Total Games Won',
                      data: values,
                      borderWidth: 1
                  }]
              },
              options: {
                  indexAxis: 'y',
                  responsive: true,
                  scales: {
                      y: { beginAtZero: true },
                      x: { beginAtZero: true }
                  }
              }
          });
      }, 100);
    } 

    if (lost === 1) {
        document.getElementById("youLose").style.display = "block";
        document.getElementById("guess-button").style.display = "none";

        setTimeout(() => {
          const ctxWin = document.getElementById('userChartLose').getContext('2d');
          new Chart(ctxWin, {
              type: 'bar',
              data: {
                  labels: labels,
                  datasets: [{
                      label: 'Total Games Won',
                      data: values,
                      borderWidth: 1
                  }]
              },
              options: {
                  indexAxis: 'y',
                  responsive: true,
                  scales: {
                      y: { beginAtZero: true },
                      x: { beginAtZero: true }
                  }
              }
          });
      }, 100);
    } 
  };

  function changeImageOnHover(element) {
            let currentSrc = element.src;
            element.dataset.originalSrc = currentSrc; // Store original src
            element.src = currentSrc.includes("cleaned_flags") 
                ? currentSrc.replace("cleaned_flags", "flags") 
                : currentSrc.replace("flags", "cleaned_flags");
        }

        function revertImage(element) {
            element.src = element.dataset.originalSrc; // Restore original src
        }
  
  const labels = {{ labels | tojson }};
  const values = {{ values | tojson }};

  const ctx = document.getElementById('userChart').getContext('2d');
  new Chart(ctx, {
      type: 'bar',  // Change to 'pie', 'line', etc.
      data: {
          labels: labels,
          datasets: [{
              label: 'Total Games Won',
              data: values,
              borderWidth: 1
          }]
      },
      options: {
        indexAxis: 'y',
          responsive: true,
          scales: {
              y: { beginAtZero: true },
              x: { beginAtZero: true }
          }
      }
  });
  
  $(document).ready(function() {
    $('#guessedcountry').select2({
    placeholder: " -- pick a country to guess! -- ",
    allowClear: true
    });
  });
  
</script>
</body>
</html>